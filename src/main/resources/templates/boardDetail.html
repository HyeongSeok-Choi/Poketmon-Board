<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{common/layouts/defaultLayout}"
      layout:fragment="Content">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/Likes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>

    <script>

        window.onload = () => {
            const like = document.querySelector('.fa');
            let counting = 0;
            document.getElementById('btn-like').style.background = 'blue';

            //게시물 조회시 좋아요버튼 상태 표시
            viewLike();

            function viewLike() {


                var check = "check";
                fetch(`http://localhost:8080/api/likes`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body:
                        JSON.stringify({
                            boardId: document.getElementById("board-id").value,
                            check: check
                        })
                    ,
                    method: 'POST',
                })
                    .then(response => response.json())
                    .then(data => {
                        getCountingLike();
                        if (!data) {
                            const like = document.querySelector('.fa');

                            like.classList.toggle("fa-thumbs-down")

                        } else {

                        }
                    });
            }

            //좋아요 클릭 이벤트
            like.addEventListener("click", (e) => {
                var check = "getlike";
                fetch(`http://localhost:8080/api/likes`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body:
                        JSON.stringify({
                            boardId: document.getElementById("board-id").value,
                            check: check
                        })
                    ,
                    method: 'POST',
                })
                    .then(response => response.json())
                    .then(data => {
                        var countLike = document.getElementById("likeCount");
                        getCountingLike();
                        var countValue = counting;
                        countLike.innerHTML = (`<p>좋아요수: ${countValue}</p>`);

                    });

                e.target.classList.toggle("fa-thumbs-down");
            });


            //좋아요 수 조회
            function getCountingLike() {
                var check = "check";
                fetch(`http://localhost:8080/api/likes/getCounting`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body:
                        JSON.stringify({
                            boardId: document.getElementById("board-id").value,
                            check: check
                        })
                    ,
                    method: 'POST',
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        var countLike = document.getElementById("likeCount");
                        countLike.innerHTML = (`<p>좋아요수: ${data}</p>`);
                    });
            }


        };

        <!--좋아요 수 렌더링-->

    </script>
    <style>
        body {
            min-height: 100vh;
        }

        .input-form {
            max-width: 680px;

            margin-top: 80px;
            padding: 32px;

            background: #fff;

            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);
            -moz-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);
            box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15)
        }

        .err {
            color: #0b5ed7;
        }
    </style>

</head>
<body>


<div class="container">
    <div class="input-form-backgroud row">
        <div class="input-form col-md-12 mx-auto">
            <input type="hidden" id="board-id" th:value="${board.id}">


            <h4 class="mb-3">게시물 조회</h4>
            <p th:text="'조회수: '+${board.getViewCount()}">조회수</p>
            <!--제목 입력-->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="title">제목</label>
                    <input type="text" class="form-control" id="title" name="title" th:value="${board.title}" readonly>
                </div>
                <div th:replace="~{/attachFile/boardAttachFile.html}">
                </div>

                <!--내용 입력-->


            </div>
            <div class="mb-3">
                <label for="content">내용</label>
                <textarea class="form-control" id="content" name="content" placeholder="프로젝트 내용을 입력해주세요"
                          th:text="${board.content}" readonly></textarea>
            </div>

            <!--좋아요 버튼-->
            <button id='btn-like'>
                <i class="fa fa-thumbs-up"></i>
            </button>
            <!--좋아요 수 렌더링-->
            <div id="likeCount">

            </div>
            <!--좋아요 버튼 끝-->

            <hr class="mb-4">

            <h5 class="mb-3">해시태그</h5>
            <ul style="list-style:none">
                <i th:each="hash:${hashTag}">
                    <li style="float: left; margin-right: 20px" th:text="'#'+${hash.getHashTagContent()}"></li>
                </i>
            </ul>

            <div style="clear: both;" class="col-md-6 mb-3">
                <form class="validation-form"  method="post" th:action="@{/modifyBoard(id=${board.id})}">
                    <button class="btn btn-primary btn btn-block" type="submit" >수정</button>
                    <button class="btn btn-danger btn btn-block" type="submit" >삭제</button>
                </form>
            </div>
            <!--댓글출현 !!-->
            <div class="input-form col-md-12 mx-auto" th:replace="~{/ReplyView.html}">
            </div>
        </div>

    </div>
</div>

</body>
</html>