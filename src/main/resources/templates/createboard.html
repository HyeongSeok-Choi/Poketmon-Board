<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layouts/defaultLayout}"
      layout:fragment="Content">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            min-height: 100vh;
        }

        .input-form {
            max-width: 680px;

            margin-top: 80px;
            padding: 32px;

            background: #fff;

            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);
            -moz-box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15);
            box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.15)
        }

        .err {
            color: #0b5ed7;
        }

        li {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="input-form-backgroud row">
        <div class="input-form col-md-12 mx-auto">

            <h4 class="mb-3">게시물 등록</h4>
            <form class="validation-form" enctype="multipart/form-data" method="post" action="/createBoardRequest"
                  th:object="${attachFileFormDto}">

                <input type="hidden" th:if="${param.id} !=null" th:value="${param.id}" name="boardid">

                <!--제목 입력-->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="title">제목</label>
                        <input th:value="${board.getTitle}" class="form-control" id="title" name="title">
                    </div>
                </div>

                <!--내용 입력-->
                <div class="mb-3">
                    <label for="content">내용</label>
                    <textarea th:text="${board.getContent()}" class="form-control" id="content" name="content"
                              placeholder="프로젝트 내용을 입력해주세요"></textarea>
                </div>

                <!--첨부파일-->
                <div class="form-group row">

                    <div class="input-form col-md-12 mx-auto" th:replace="~{/attachFile/attachFile.html}">

                    </div>
                </div>


                <!--해시 태그 입력-->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="addValue">해시태그</label>

                        <ul class='hashTag' id='hashTag' style="list-style-type: none">
                            <li th:each="hash:${hashTags}" th:if="${hash.getHashTagContent()} != null"
                                th:text="'#'+${hash.getHashTagContent()}"></li>
                        </ul>
                        <input type='text' id='addValue'/>
                        <input class="btn btn-primary btn-lg btn-block" type='button' value='추가' onclick='addList()'/>
                    </div>
                </div>
                <input type="hidden" id="hashTagValue" name="hashTagValue">

                <hr class="mb-4">
                <button class="btn btn-primary btn-lg btn-block" type="submit" onclick="return validateContent() && getHashTag()">
                    작성 완료
                </button>
            </form>
        </div>
    </div>
</div>
<script>

    // 실시간으로 내용에 블러 처리 적용
    const contentTextarea = document.getElementById('content');

    contentTextarea.addEventListener('input', function () {
        const content = contentTextarea.value;
        const blurredContent = blurPersonalInfo(content);
        contentTextarea.value = blurredContent;
    });

    function blurPersonalInfo(content) {
        // 주민등록번호 형식의 패턴을 정규표현식으로 정의
        const personalInfoPattern = /\b\d{6}-\d{7}\b/g; // 주민등록번호 패턴
        // 개인정보 패턴을 찾아서 블러 처리 적용
        return content.replace(personalInfoPattern, '********');
    }

    // 내용 유효성 검사
    function validateContent() {
        const content = document.getElementById('content').value;
        const personalInfoPattern = /\b\d{6}-\d{7}\b/g; // 주민등록번호 패턴
        if (!personalInfoPattern.test(content)) {
            alert('민감한 정보가 포함되어 있습니다. 주의하세요!');
            // return false;
        }
        return true;
    }



    $(document).on('click', '.hashTag li', function () {

        $(this).remove();
    });


    const hashtag = []


    function addList() {

        if ($("li").length < 5) {

            // 1. 추가할 값을 input창에서 읽어온다
            const addValue
                = document.getElementById('addValue').value;

            // 2. 추가할 li element 생성
            // 2-1. 추가할 li element 생성
            const li = document.createElement("li");


            // 2-3. li에 text node 추가
            const textNode = document.createTextNode('#' + addValue);
            li.appendChild(textNode);

            // 3. 생성된 li를 ul에 추가

            document
                .getElementById('hashTag')
                .appendChild(li);
            document.getElementById("addValue").value = null;


        } else {
            alert("해시태그는 5개까지 등록 가능합니다.")
        }
    }


    function getHashTag() {

        $("#hashTag").children().each(function () {

            hashtag.push($(this).text());
        });

        document.getElementById("hashTagValue").value = hashtag;
    }

</script>

</body>
</html>